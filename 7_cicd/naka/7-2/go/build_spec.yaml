# https://docs.oracle.com/ja-jp/iaas/Content/devops/using/build_specs.htm
# build runner config
version: 0.1
component: build
timeoutInSeconds: 10000
shell: bash
env: 
  variables:
    image_name: go-test
    image_version: 0.0.5
  exportedVariables:
    - tag

steps:
  - type: Command
    name: "Docker image build"
    timeoutInSeconds: 600
    command: |
      cd go
      docker build -t ${image_name}:${image_version} .
      docker images
      docker tag ${image_name}:${image_version} go-image
      tag=$(date '+%Y%m%d_%H%M%S')  # Insert date+time to tag
      docker images
    onFailure:
      - type: Command
        command: |
          echo "Failure successfully handled"
        timeoutInSeconds: 60

outputArtifacts:
  - name: go-image
    type: DOCKER_IMAGE
    location: go-image
  - name: deployment_yaml
    type: BINARY
    location: go/deployment.yaml
